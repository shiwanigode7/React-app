{"ast":null,"code":"function _toConsumableArray(arr) { return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread(); }\n\nfunction _nonIterableSpread() { throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\n\nfunction _iterableToArray(iter) { if (typeof Symbol !== \"undefined\" && iter[Symbol.iterator] != null || iter[\"@@iterator\"] != null) return Array.from(iter); }\n\nfunction _arrayWithoutHoles(arr) { if (Array.isArray(arr)) return _arrayLikeToArray(arr); }\n\nfunction _typeof(obj) { \"@babel/helpers - typeof\"; if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\nfunction _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }\n\nfunction _nonIterableRest() { throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\n\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\nfunction _iterableToArrayLimit(arr, i) { var _i = arr == null ? null : typeof Symbol !== \"undefined\" && arr[Symbol.iterator] || arr[\"@@iterator\"]; if (_i == null) return; var _arr = []; var _n = true; var _d = false; var _s, _e; try { for (_i = _i.call(arr); !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"] != null) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; }\n\nfunction _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport React from \"react\";\nimport PropTypes from \"prop-types\";\nimport clsx from \"clsx\";\nimport { makeStyles } from \"@material-ui/core/styles\";\nimport { FormControl, InputLabel, Chip, TableCell, Link, Popover, Typography } from \"@material-ui/core\";\nimport PopupState, { bindTrigger, bindPopover } from \"material-ui-popup-state\";\nimport { DataView, UserBadge, Button, ObjectView, Section } from \"@esko/cloud-ui-components\";\nimport PropertyField from \"../ObjectView/propertyField\";\nimport Delete from \"@material-ui/icons/Delete\";\nimport Add from \"@material-ui/icons/Add\";\nimport AddGroup from \"@material-ui/icons/GroupAdd\";\nimport GroupIcon from \"@material-ui/icons/Group\";\nimport Unchecked from \"@material-ui/icons/CheckBoxOutlineBlankRounded\";\nimport Checked from \"@material-ui/icons/CheckBoxRounded\";\nimport ListIcon from \"@material-ui/icons/List\";\nimport { editOrgUser, deleteOrgUsers, getOrgUsersJoin, removeFromGroup, addToGroup } from \"../../data/requests/iam\";\nimport MuiDialog from \"../Dialog/dialog\";\nimport CreateUserForm from \"./createUserForm\";\nimport { checkACL } from \"../../data/requests/repo\";\nimport GroupsInput from \"./GroupsInput\";\nimport useEventBus from \"../../utils/hooks/useEventBus\";\nimport { timeFormatter } from \"../../utils/dateTime\";\nimport { useComponentsTranslation } from \"../../i18n/useComponentsTranslation\";\nimport { useTranslation } from \"react-i18next\";\nvar userDetailsWidth = 400;\nvar styles = makeStyles(function (theme) {\n  return {\n    usersContainer: {\n      alignItems: \"center\",\n      padding: theme.spacing(1),\n      boxSizing: \"border-box\",\n      height: \"100%\",\n      width: \"100%\",\n      position: \"relative\",\n      display: \"flex\",\n      flexDirection: \"row\"\n    },\n    usersDataContainer: {\n      flex: 1,\n      height: \"100%\"\n    },\n    userObjectContainer: {\n      flexBasis: userDetailsWidth,\n      flexGrow: 0,\n      flexShrink: 0,\n      height: \"100%\",\n      marginLeftt: 10\n    },\n    userObjectPanel: {\n      borderLeftColor: theme.palette.type == \"dark\" ? theme.palette.grey[700] : theme.palette.grey[300],\n      backgroundColor: theme.palette.type === \"light\" ? \"white\" : theme.palette.action.selected\n    },\n    userObjectContent: {\n      paddingLeft: theme.spacing(2),\n      paddingRight: theme.spacing(2),\n      width: userDetailsWidth,\n      boxSizing: \"border-box\"\n    },\n    userObjectUserBadge: {\n      marginBottom: theme.spacing(2)\n    },\n    flexContainer: {\n      display: \"flex\",\n      alignItems: \"center\",\n      boxSizing: \"border-box\"\n    },\n    tableCell: {\n      flex: 1,\n      border: \"none\"\n    },\n    ellipsisCell: {\n      minWidth: 0,\n      overflow: \"hidden\",\n      textOverflow: \"ellipsis\",\n      whiteSpace: \"nowrap\"\n    },\n    userCard: {\n      maxWidth: 300\n    },\n    userCardAvatar: {\n      justifyContent: \"center\"\n    },\n    groupChipContainer: {\n      display: \"flex\",\n      flexWrap: \"wrap\",\n      listStyle: \"none\",\n      padding: theme.spacing(0.5),\n      marginTop: 20\n    },\n    groupChip: {\n      marginLeft: theme.spacing(0.5),\n      marginBottom: theme.spacing(0.5)\n    },\n    longText: {\n      overflow: \"hidden\",\n      textOverflow: \"ellipsis\",\n      display: \"-webkit-box\",\n      WebkitLineClamp: 2,\n      WebkitBoxOrient: \"vertical\",\n      whiteSpace: \"break-spaces\"\n    },\n    addGroupInput: {\n      width: 450,\n      height: 350,\n      padding: theme.spacing(2)\n    },\n    addRemoveGroups: {\n      marginLeft: theme.spacing(2)\n    },\n    createdByLine: {\n      marginTop: theme.spacing(1)\n    },\n    activeRow: {\n      cursor: \"pointer\"\n    },\n    selectedRow: {\n      backgroundColor: theme.palette.type === \"light\" ? theme.palette.primary.light : theme.palette.background.paper\n    },\n    focusedRow: {\n      backgroundColor: theme.palette.type === \"light\" ? theme.palette.grey[200] : theme.palette.leftNavBackground\n    },\n    tableRow: {\n      borderBottom: \"1px solid transparent\",\n      borderBottomColor: theme.palette.type === \"light\" ? theme.palette.grey[200] : theme.palette.grey[600]\n    },\n    tableRowHover: {\n      \"&:hover\": {\n        backgroundColor: theme.palette.type === \"light\" ? theme.palette.grey[300] : theme.palette.grey[800]\n      }\n    },\n    noPadding: {\n      padding: 0\n    },\n    focusedUserSection: {\n      background: \"transparent\"\n    },\n    focusedUserHeaderName: {\n      fontWeight: \"bold\"\n    },\n    userPropertyLabel: {\n      width: 110\n    }\n  };\n});\n\nvar groupCell = function groupCell(_ref) {\n  var props = _ref.props,\n      classes = _ref.classes;\n  var groups = props.rowData.groups;\n  var groupText = groups ? Object.keys(groups).sort().join(\", \") : \"-\";\n  var cellData = /*#__PURE__*/React.createElement(\"div\", {\n    title: groupText,\n    className: clsx(classes.longText)\n  }, groupText);\n  return /*#__PURE__*/React.createElement(TableCell, {\n    component: \"div\",\n    className: clsx(classes.tableCell, classes.flexContainer),\n    variant: \"body\"\n  }, cellData);\n};\n\nvar usersRowRenderer = function usersRowRenderer(_ref2) {\n  var _clsx;\n\n  var row = _ref2.row,\n      defaultTableRowRenderer = _ref2.defaultTableRowRenderer,\n      classes = _ref2.classes;\n  var onRowClick = row.onRowClick,\n      index = row.index,\n      isSelected = row.isSelected,\n      selectedRowClass = row.selectedRowClass,\n      rowData = row.rowData;\n  row.className = clsx(classes.tableRow, classes.tableRowHover, classes.flexContainer, row.className, (_clsx = {}, _defineProperty(_clsx, classes.selectedRow, isSelected), _defineProperty(_clsx, classes.focusedRow, rowData.focused), _defineProperty(_clsx, classes.activeRow, typeof onRowClick == \"function\"), _clsx));\n  return defaultTableRowRenderer(row);\n};\n\nvar createdByCell = function createdByCell(_ref3) {\n  var props = _ref3.props,\n      classes = _ref3.classes,\n      t = _ref3.t;\n  var _props$rowData = props.rowData,\n      createdByFirstName = _props$rowData.createdByFirstName,\n      createdByLastName = _props$rowData.createdByLastName;\n  var cellData = createdByFirstName && createdByLastName ? createdByLastName + \", \" + createdByFirstName : t(\"system\");\n  return /*#__PURE__*/React.createElement(TableCell, {\n    component: \"div\",\n    className: clsx(classes.tableCell, classes.ellipsisCell),\n    variant: \"body\"\n  }, cellData);\n};\n\nvar userCell = function userCell(_ref4) {\n  var classes = _ref4.classes,\n      props = _ref4.props;\n  var rowData = props.rowData;\n  var firstThanLastName = rowData.firstThanLastName,\n      editable = rowData.editable,\n      userInfo = rowData.userInfo,\n      role = rowData[\"ec_s@function\"],\n      mobileNumber = rowData.mobileNumber,\n      email = rowData[\"ec_s@email\"],\n      groups = rowData.groups;\n  return /*#__PURE__*/React.createElement(TableCell, {\n    component: \"div\",\n    className: clsx(classes.tableCell, classes.flexContainer),\n    variant: \"body\"\n  }, /*#__PURE__*/React.createElement(UserBadge, {\n    firstThanLastName: firstThanLastName,\n    variant: \"horizontal\",\n    size: \"small\",\n    userInfo: userInfo\n  }));\n};\n\nvar AddRemoveGroups = function AddRemoveGroups(_ref5) {\n  var focusedUser = _ref5.focusedUser,\n      handleRemove = _ref5.handleRemove,\n      classes = _ref5.classes,\n      groupsInputProps = _ref5.groupsInputProps,\n      t = _ref5.t;\n\n  var _a;\n\n  return /*#__PURE__*/React.createElement(\"span\", {\n    className: clsx(classes.addRemoveGroups)\n  }, /*#__PURE__*/React.createElement(PopupState, {\n    variant: \"popover\",\n    popupId: \"add-groups-popover\"\n  }, function (popupState) {\n    return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(Link, Object.assign({}, bindTrigger(popupState)), t(\"add\")), /*#__PURE__*/React.createElement(Popover, Object.assign({}, bindPopover(popupState), {\n      anchorOrigin: {\n        vertical: \"top\",\n        horizontal: \"left\"\n      },\n      transformOrigin: {\n        vertical: \"bottom\",\n        horizontal: \"right\"\n      },\n      disableRestoreFocus: true\n    }), /*#__PURE__*/React.createElement(\"div\", {\n      className: clsx(classes.addGroupInput)\n    }, /*#__PURE__*/React.createElement(GroupsInput, Object.assign({}, groupsInputProps)))));\n  }), ((_a = focusedUser === null || focusedUser === void 0 ? void 0 : focusedUser.groupsToLeave) === null || _a === void 0 ? void 0 : _a.length) ? /*#__PURE__*/React.createElement(React.Fragment, null, \" \", \"| \", /*#__PURE__*/React.createElement(Link, {\n    onClick: handleRemove\n  }, t(\"remove\")), \" \") : \"\");\n};\n\nvar searchInitialState = {\n  sortBy: \"name\",\n  start: 0,\n  size: 20,\n  search: \"\",\n  sortDirection: \"asc\",\n  filterType: [\"surName\", \"firstName\", \"displayName\", \"email\"]\n};\nvar cleanDialog = {\n  title: \"\",\n  open: false,\n  content: \"\",\n  actions: \"\",\n  disableTitleTypography: false\n};\nvar emptyFocusedUser = {\n  user: {},\n  groupsToLeave: []\n};\nvar initialInputsState = {\n  openAddUser: false,\n  openAddGroups: false,\n  disableTable: false,\n  disableFocusGroups: false,\n  disableFocus_mobileNumber: false,\n  disableFocus_initial: false,\n  disableFocus_function: false\n};\n\nvar selectedUserComponent = function selectedUserComponent(_ref6) {\n  var data = _ref6.data,\n      selectKey = _ref6.selectKey;\n  return /*#__PURE__*/React.createElement(UserBadge, {\n    variant: \"horizontal\",\n    size: \"small\",\n    userInfo: data.userInfo,\n    firstThanLastName: data.firstThanLastName\n  });\n};\n\nvar Users = function Users(_ref7) {\n  var onSelectionChange = _ref7.onSelectionChange,\n      organization = _ref7.organization,\n      repoId = _ref7.repoId,\n      onError = _ref7.onError,\n      language = _ref7.language;\n\n  var handleOnSelectionChange = function handleOnSelectionChange(changed) {\n    if (typeof onSelectionChange == \"function\") {\n      onSelectionChange(changed);\n    }\n  };\n\n  var classes = styles();\n  var socket = React.useRef();\n  var timeoutTokenDeleteUsers = React.useRef();\n  React.useEffect(function () {\n    var _a;\n\n    if (repoId) {\n      if ((_a = socket.current) === null || _a === void 0 ? void 0 : _a.close) {\n        socket.current.close();\n      }\n\n      socket.current = useEventBus({\n        path: \"\".concat(repoId, \"/EC:IAM/Users\")\n      });\n      getPermisions();\n    }\n  }, [repoId]);\n  React.useEffect(function () {\n    return function () {\n      var _a, _b;\n\n      return ((_a = socket.current) === null || _a === void 0 ? void 0 : _a.close) ? (_b = socket.current) === null || _b === void 0 ? void 0 : _b.close() : false;\n    };\n  }, []);\n\n  var _React$useState = React.useState([]),\n      _React$useState2 = _slicedToArray(_React$useState, 2),\n      users = _React$useState2[0],\n      setUsers = _React$useState2[1];\n\n  var _React$useState3 = React.useState({}),\n      _React$useState4 = _slicedToArray(_React$useState3, 2),\n      search = _React$useState4[0],\n      setSearch = _React$useState4[1];\n\n  var _React$useState5 = React.useState(cleanDialog),\n      _React$useState6 = _slicedToArray(_React$useState5, 2),\n      dialog = _React$useState6[0],\n      setDialog = _React$useState6[1];\n\n  var _React$useState7 = React.useState([]),\n      _React$useState8 = _slicedToArray(_React$useState7, 2),\n      permisions = _React$useState8[0],\n      setPermisions = _React$useState8[1];\n\n  var _React$useState9 = React.useState(initialInputsState),\n      _React$useState10 = _slicedToArray(_React$useState9, 2),\n      inputsState = _React$useState10[0],\n      setInputsState = _React$useState10[1];\n\n  var _React$useState11 = React.useState(emptyFocusedUser),\n      _React$useState12 = _slicedToArray(_React$useState11, 2),\n      focusedUser = _React$useState12[0],\n      focusUser = _React$useState12[1];\n\n  var _useComponentsTransla = useComponentsTranslation(),\n      i18next = _useComponentsTransla.i18next,\n      updatei18next = _useComponentsTransla.updatei18next,\n      I18nextProvider = _useComponentsTransla.I18nextProvider;\n\n  var _useTranslation = useTranslation(\"components\"),\n      t = _useTranslation.t;\n\n  React.useEffect(function () {\n    updatei18next(language);\n  }, [language]);\n\n  var closeDialog = function closeDialog() {\n    setDialog(cleanDialog);\n  };\n\n  var sortUsers = function sortUsers(searchParams) {\n    getUsers(searchParams, true);\n  };\n\n  var getMoreUsers = function getMoreUsers(searchParams) {\n    getUsers(searchParams);\n  };\n\n  var searchUsers = function searchUsers(searchTerm) {\n    getUsers({\n      search: searchTerm,\n      startIndex: 0\n    }, true);\n  };\n\n  var handleError = function handleError(err, errorType) {\n    var Repsonse = err.clone().json()[\"catch\"](function () {\n      return res.text();\n    });\n\n    if (typeof onError === \"function\") {\n      onError(err);\n    } else {\n      setDialog(Object.assign(Object.assign({}, cleanDialog), {\n        title: \"ERROR:\",\n        open: true,\n        content: /*#__PURE__*/React.createElement(Typography, {\n          variant: \"body1\"\n        }, errorType + \": \" + JSON.stringify(err)),\n        actions: /*#__PURE__*/React.createElement(Button, {\n          onClick: closeDialog\n        }, t(\"close\"))\n      }));\n    }\n  };\n\n  var getUsers = function getUsers() {\n    var searchParams = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    var clear = arguments.length > 1 ? arguments[1] : undefined;\n    var updateFocusedUSer = arguments.length > 2 ? arguments[2] : undefined;\n    var clearWhenDone = !!clear;\n    setSearch(function (currSearch) {\n      var newSearch = Object.assign(Object.assign(Object.assign({}, currSearch), searchParams), {\n        start: _typeof(searchParams.startIndex) === undefined ? currSearch.start : searchParams.startIndex\n      });\n      getOrgUsersJoin(Object.assign({\n        organization: organization\n      }, newSearch)).then(function (resp) {\n        //it's important total of the state is set before getting the new elements\n        setSearch(function (currSearch) {\n          return Object.assign(Object.assign({}, currSearch), {\n            total: resp.hits.total || undefined\n          });\n        });\n        setUsers(function (currUsers) {\n          var _a;\n\n          var newUsers = clearWhenDone ? [] : _toConsumableArray(currUsers);\n\n          if ((_a = resp === null || resp === void 0 ? void 0 : resp.hits) === null || _a === void 0 ? void 0 : _a.hits) {\n            newUsers = newUsers.concat(resp.hits.hits.map(function (_ref8) {\n              var _ref9;\n\n              var usr = _ref8._source;\n              var email = usr[\"ec_s@email\"],\n                  firstName = usr[\"ec_s@firstName\"],\n                  lastName = usr[\"ec_s@surName\"],\n                  displayName = usr[\"ec_t@displayName\"],\n                  role = usr[\"ec_s@function\"],\n                  rawGroups = usr[\"ec_s@groupMembership\"],\n                  mobileNumber = usr[\"ec_s@mobileNumber\"],\n                  initials = usr[\"ec_s@initials\"],\n                  createdByFirstName = usr.createdByFirstName,\n                  createdByLastName = usr.createdByLastName,\n                  creationDate = usr.creationDate,\n                  nodeId = usr.nodeId,\n                  path = usr.path;\n              var groups = {};\n              rawGroups.forEach(function (grp) {\n                var grpKey = decodeURIComponent(grp.split(\"/\").pop());\n                groups[grpKey] = grp;\n              });\n              return _ref9 = {\n                nodeId: nodeId[0].parentNodeId,\n                path: path\n              }, _defineProperty(_ref9, \"ec_s@firstName\", firstName), _defineProperty(_ref9, \"ec_s@surName\", lastName), _defineProperty(_ref9, \"ec_s@email\", email), _defineProperty(_ref9, \"ec_t@displayName\", displayName), _defineProperty(_ref9, \"ec_s@function\", role), _defineProperty(_ref9, \"createdByFirstName\", createdByFirstName), _defineProperty(_ref9, \"createdByLastName\", createdByLastName), _defineProperty(_ref9, \"creationDate\", creationDate), _defineProperty(_ref9, \"initials\", initials), _defineProperty(_ref9, \"firstThanLastName\", false), _defineProperty(_ref9, \"editable\", permisions.includes(\"allow-manage-write\")), _defineProperty(_ref9, \"groups\", groups), _defineProperty(_ref9, \"mobileNumber\", mobileNumber), _defineProperty(_ref9, \"userInfo\", {\n                firstName: firstName,\n                lastName: lastName,\n                displayName: displayName,\n                avatar: nodeId[0][\"contentPath-S3-thumbnail-200x200\"]\n              }), _ref9;\n            }));\n          }\n\n          focusUser(function (currFocusedUser) {\n            var email = currFocusedUser === null || currFocusedUser === void 0 ? void 0 : currFocusedUser.user[\"ec_s@email\"];\n\n            if (!email) {\n              return currFocusedUser;\n            }\n\n            var newFocusedUserData = newUsers.filter(function (usr) {\n              return usr[\"ec_s@email\"] === email;\n            });\n\n            if (newFocusedUserData[0]) {\n              newFocusedUserData[0].focused = true;\n            }\n\n            return Object.assign(Object.assign({}, currFocusedUser), {\n              user: newFocusedUserData[0] || Object.assign({}, currFocusedUser.user)\n            });\n          });\n          return newUsers;\n        });\n      }, function (err) {\n        handleError(err, t(\"gettingUsers\"));\n      });\n      return newSearch;\n    });\n  };\n\n  var toggleInputState = function toggleInputState(key, open) {\n    return function () {\n      setInputsState(function (currInputState) {\n        return Object.assign(Object.assign({}, currInputState), _defineProperty({}, key, open));\n      });\n    };\n  };\n\n  var confirmDeleteUsers = function confirmDeleteUsers(_ref10) {\n    var selected = _ref10.selected,\n        clearSelected = _ref10.clearSelected;\n    var count = (selected === null || selected === void 0 ? void 0 : selected.length) || 1;\n    var aboutDeleteUsers = users.filter(function (usr) {\n      return selected.indexOf(usr.nodeId) > -1;\n    }).map(function (_ref11) {\n      var name = _ref11[\"ec_s@email\"],\n          path = _ref11.path;\n      return {\n        name: name,\n        path: path\n      };\n    });\n    var actions = /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(Button, {\n      onClick: closeDialog\n    }, t(\"no\")), /*#__PURE__*/React.createElement(Button, {\n      onClick: function onClick() {\n        return deleteUsers(aboutDeleteUsers, clearSelected);\n      }\n    }, t(\"yes\")));\n    setDialog(Object.assign(Object.assign({}, cleanDialog), {\n      title: t(\"deleteUser\", {\n        count: count\n      }),\n      open: true,\n      content: /*#__PURE__*/React.createElement(Typography, {\n        variant: \"body1\"\n      }, t(\"deleteUserPrompt\", {\n        count: count\n      })),\n      actions: actions\n    }));\n  };\n\n  var deleteUsers = function deleteUsers(users, clearSelected) {\n    var count = (users === null || users === void 0 ? void 0 : users.length) || 1;\n    setDialog(Object.assign(Object.assign({}, cleanDialog), {\n      title: t(\"deleteUser\", {\n        count: count\n      }),\n      open: true,\n      content: /*#__PURE__*/React.createElement(Typography, {\n        variant: \"body1\"\n      }, t(\"deletingUser\", {\n        count: count\n      })),\n      actions: \"\"\n    }));\n    deleteOrgUsers({\n      organization: organization,\n      users: users\n    }).then(function (resp) {\n      setRefreshListener({\n        callbackId: \"deletingUsers\",\n        callback: function callback(msg) {\n          var jsonMsg = JSON.parse(msg.data);\n\n          if (jsonMsg.payloadType === \"ChildRemoved\") {\n            clearTimeout(timeoutTokenDeleteUsers.current);\n            timeoutTokenDeleteUsers.current = setTimeout(function () {\n              getUsers(\"\", true);\n              socket.current.stopListening(\"deletingUsers\");\n              setDialog(Object.assign(Object.assign({}, cleanDialog), {\n                title: t(\"deleteUser\", {\n                  count: count\n                }),\n                open: true,\n                content: /*#__PURE__*/React.createElement(Typography, {\n                  variant: \"body1\"\n                }, t(\"deleteUserSuccess\", {\n                  count: count\n                })),\n                actions: /*#__PURE__*/React.createElement(Button, {\n                  onClick: closeDialog\n                }, t(\"close\"))\n              }));\n            }, 500);\n          }\n        }\n      });\n      clearSelected();\n      var focusedUserInDeleted = users.some(function (usr) {\n        return usr.name === focusedUser.user[\"ec_s@email\"];\n      });\n\n      if (focusedUserInDeleted) {\n        focusUser(emptyFocusedUser);\n      }\n    }, function (err) {\n      handleError(err, t(\"deletingUsers\"));\n    });\n  };\n\n  var handleUSerAdded = function handleUSerAdded() {\n    /* The service to add a user seems to wait for the user to be added to the index\n    as it needs to set permisions and initial group adding, so we don't need listen to\n    the even bus for this as we will always missing the event*/\n    setDialog(Object.assign(Object.assign({}, cleanDialog), {\n      title: t(\"addUser\"),\n      open: true,\n      content: /*#__PURE__*/React.createElement(Typography, {\n        variant: \"body1\"\n      }, t(\"addUserSuccess\")),\n      actions: /*#__PURE__*/React.createElement(Button, {\n        onClick: closeDialog\n      }, t(\"close\"))\n    }));\n    getUsers(\"\", true);\n  };\n\n  var getPermisions = function getPermisions() {\n    if (!repoId) {\n      return;\n    }\n\n    var aces = [];\n    var nodePath = [repoId, \"EC:IAM\", \"Users\"];\n    checkACL({\n      nodePath: nodePath\n    }).then(function (resp) {\n      var _a;\n\n      if (((_a = resp === null || resp === void 0 ? void 0 : resp.aces) === null || _a === void 0 ? void 0 : _a.length) && resp.aces[0].ace) {\n        aces = resp.aces[0].ace.split(\"|\");\n      }\n\n      setPermisions(aces);\n    }, function (err) {\n      handleError(err, t(\"gettingPermisions\"));\n    });\n  };\n\n  var addUserCondition = React.useCallback(function (selected) {\n    return permisions.indexOf(\"allow-manage-create\") > -1;\n  }, [permisions]);\n  var deleteUserCondition = React.useCallback(function (selected) {\n    return Array.isArray(selected) && selected.length > 0 && permisions.indexOf(\"allow-manage-delete\") > -1;\n  }, [permisions]);\n  var usersActions = [{\n    icon: /*#__PURE__*/React.createElement(Delete, null),\n    label: t(\"deleteUser\", {\n      count: 2\n    }),\n    condition: deleteUserCondition,\n    onClick: confirmDeleteUsers\n  }, {\n    icon: /*#__PURE__*/React.createElement(Add, null),\n    label: t(\"addUser\"),\n    onClick: toggleInputState(\"openAddUser\", true),\n    condition: addUserCondition,\n    color: \"primary\"\n  }];\n  React.useEffect(function () {\n    setUsers([]);\n    focusUser(emptyFocusedUser);\n    setInputsState(initialInputsState);\n    getUsers(searchInitialState);\n  }, [organization]);\n\n  var setRefreshListener = function setRefreshListener(_ref12) {\n    var callbackId = _ref12.callbackId,\n        _ref12$callback = _ref12.callback,\n        callback = _ref12$callback === void 0 ? function (msg) {\n      return console.log(msg);\n    } : _ref12$callback;\n\n    if (socket.current.listen) {\n      socket.current.listen(callback, callbackId);\n    } else {\n      console.error(\"users socket not set\");\n    }\n  };\n\n  var handlefocusUser = function handlefocusUser(_ref13) {\n    var event = _ref13.event,\n        index = _ref13.index,\n        rowData = _ref13.rowData;\n    //assing new data to focused user\n    focusUser({\n      user: rowData,\n      groupsToLeave: []\n    }); //mark List user as focused for row styling\n\n    setUsers(function (currUsers) {\n      var newUsers = _toConsumableArray(currUsers);\n\n      newUsers.some(function (usr, idx, arr) {\n        arr[idx] = usr.focused ? Object.assign(Object.assign({}, usr), {\n          focused: false\n        }) : arr[idx];\n        return usr.focused;\n      });\n      newUsers[index].focused = true;\n      return newUsers;\n    }); //reset inputs\n\n    setInputsState(initialInputsState);\n  };\n\n  var handleCloseFocusedUser = function handleCloseFocusedUser() {\n    focusUser(emptyFocusedUser);\n    setUsers(function (currUsers) {\n      var newUsers = _toConsumableArray(currUsers);\n\n      newUsers.some(function (usr, idx, arr) {\n        arr[idx] = usr.focused ? Object.assign(Object.assign({}, usr), {\n          focused: false\n        }) : arr[idx];\n        return usr.focused;\n      });\n      return newUsers;\n    });\n  };\n\n  var handleSelectToRemove = function handleSelectToRemove(group) {\n    return function () {\n      focusUser(function (currFocusUser) {\n        var newGroupsToLeave = currFocusUser.groupsToLeave;\n        var existIn = newGroupsToLeave.indexOf(group);\n\n        if (existIn > -1) {\n          newGroupsToLeave.splice(existIn, 1);\n        } else {\n          newGroupsToLeave.push(group);\n        }\n\n        return Object.assign(Object.assign({}, currFocusUser), {\n          groupsToLeave: newGroupsToLeave\n        });\n      });\n    };\n  };\n\n  var handleRemoveFromGroup = function handleRemoveFromGroup(e) {\n    if (e) {\n      e.preventDefault();\n    }\n\n    toggleInputState(\"disableFocusGroups\", true)();\n    removeFromGroup({\n      groupNames: focusedUser.groupsToLeave,\n      organization: organization,\n      email: focusedUser.user[\"ec_s@email\"]\n    }).then(function (resp) {\n      //now that it went well remove groups locally and subscribe a listener for the bus event\n      setRefreshListener({\n        callbackId: focusedUser.user.nodeId,\n        callback: function callback(msg) {\n          console.log(msg);\n          var jsonMsg = JSON.parse(msg.data);\n\n          if (jsonMsg.nodeId === focusedUser.user.nodeId) {\n            getUsers(\"\", true);\n          }\n\n          socket.current.stopListening(focusedUser.user.nodeId);\n          toggleInputState(\"disableFocusGroups\", false)();\n        }\n      });\n      focusUser(function (currentFocusedUser) {\n        var newFocusedUser = Object.assign({}, currentFocusedUser);\n        newFocusedUser.groupsToLeave.forEach(function (grp) {\n          delete newFocusedUser.user.groups[grp];\n        });\n        newFocusedUser.groupsToLeave = [];\n        setUsers(function (currUsers) {\n          var newUsers = _toConsumableArray(currUsers);\n\n          newUsers.some(function (usr, idx, arr) {\n            var found = usr[\"ec_s@email\"] === focusedUser.user[\"ec_s@email\"];\n            arr[idx] = found ? Object.assign({}, focusedUser.user) : arr[idx];\n            return found;\n          });\n          return newUsers;\n        });\n        return newFocusedUser;\n      });\n    }, function (err) {\n      handleError(err, t(\"leavingGroups\"));\n    });\n  };\n\n  var handleAddToGroup = function handleAddToGroup(_ref14) {\n    var selected = _ref14.selected,\n        clearSelected = _ref14.clearSelected;\n    var userGroups = Object.keys(focusedUser.user.groups);\n    var groupsToAdd = selected.filter(function (grp) {\n      return !userGroups.includes(grp);\n    });\n    toggleInputState(\"disableFocusGroups\", true)();\n    addToGroup({\n      groupNames: groupsToAdd,\n      organization: organization,\n      email: focusedUser.user[\"ec_s@email\"]\n    }).then(function (resp) {\n      //now that it went well add groups locally and subscribe a listener for the bus event\n      setRefreshListener({\n        callbackId: focusedUser.user.nodeId,\n        callback: function callback(msg) {\n          console.log(msg);\n          var jsonMsg = JSON.parse(msg.data);\n\n          if (jsonMsg.nodeId === focusedUser.user.nodeId) {\n            getUsers(\"\", true);\n          }\n\n          socket.current.stopListening(focusedUser.user.nodeId);\n          toggleInputState(\"disableFocusGroups\", false)();\n        }\n      });\n      focusUser(function (currentFocusedUser) {\n        var newFocusedUser = Object.assign({}, currentFocusedUser);\n        groupsToAdd.forEach(function (grp) {\n          newFocusedUser.user.groups[grp] = {};\n        });\n        setUsers(function (currUsers) {\n          var newUsers = _toConsumableArray(currUsers);\n\n          newUsers.some(function (usr, idx, arr) {\n            var found = usr[\"ec_s@email\"] === focusedUser.user[\"ec_s@email\"];\n            arr[idx] = found ? Object.assign({}, focusedUser.user) : arr[idx];\n            return found;\n          });\n          return newUsers;\n        });\n        return newFocusedUser;\n      });\n    }, function (err) {\n      handleError(err, t(\"addingToGroups\"));\n    });\n  };\n\n  var updateFocusedUserProp = function updateFocusedUserProp(valueKey, value) {\n    focusUser(function (currentFocusedUser) {\n      var newFocusedUser = Object.assign({}, currentFocusedUser);\n\n      if (newFocusedUser.user[valueKey]) {\n        newFocusedUser.user[valueKey] = value;\n      } else if (newFocusedUser.user[\"ec_s@\" + valueKey]) {\n        newFocusedUser.user[\"ec_s@\" + valueKey] = value;\n      }\n\n      return newFocusedUser;\n    });\n  };\n\n  var handleEditUserValue = function handleEditUserValue(valueObj) {\n    var valueKey = Object.keys(valueObj)[0];\n    var value = Object.values(valueObj)[0];\n    var callbackId = focusedUser.user.nodeId + \"_\" + valueKey;\n    editOrgUser({\n      organization: organization,\n      email: focusedUser.user[\"ec_s@email\"],\n      body: Object.assign({}, valueObj)\n    }).then(function (resp) {\n      //subscribe a listener for the indexed bus event\n      updateFocusedUserProp(valueKey, value);\n      setRefreshListener({\n        callbackId: callbackId,\n        callback: function callback(msg) {\n          var jsonMsg = JSON.parse(msg.data);\n\n          if (jsonMsg.payload.includes(valueKey)) {\n            console.log(jsonMsg.payload, valueKey);\n            getUsers(\"\", true);\n            socket.current.stopListening(callbackId);\n          }\n        }\n      });\n    }, function (err) {\n      handleError(err, t(\"modifiyingUser\"));\n    });\n  };\n\n  var editProps = React.useCallback(function () {\n    var editProps = undefined;\n\n    if (focusedUser) {\n      var _editProps;\n\n      editProps = (_editProps = {}, _defineProperty(_editProps, \"ec_s@email\", {\n        type: \"text\",\n        label: t(\"email\"),\n        value: focusedUser.user[\"ec_s@email\"],\n        readOnly: true\n      }), _defineProperty(_editProps, \"createdBy\", {\n        type: \"text\",\n        label: t(\"createdBy\"),\n        value: focusedUser.user.createdByFirstName && focusedUser.user.createdByLastName ? \"\".concat(focusedUser.user.createdByLastName, \", \").concat(focusedUser.user.createdByFirstName) : t(\"system\"),\n        readOnly: true\n      }), _defineProperty(_editProps, \"createdOn\", {\n        type: \"text\",\n        label: t(\"createdOn\"),\n        value: timeFormatter(new Date(focusedUser.user.creationDate), i18next.language),\n        readOnly: true\n      }), _defineProperty(_editProps, \"function\", {\n        type: \"text\",\n        label: t(\"function\"),\n        value: focusedUser.user[\"ec_s@function\"],\n        readOnly: inputsState.disableFocus_function\n      }), _defineProperty(_editProps, \"initials\", {\n        type: \"text\",\n        label: t(\"initials\"),\n        value: focusedUser.user.initials,\n        readOnly: inputsState.disableFocus_initials\n      }), _defineProperty(_editProps, \"mobileNumber\", {\n        type: \"text\",\n        label: t(\"phone\"),\n        value: focusedUser.user.mobileNumber,\n        readOnly: inputsState.disableFocus_mobileNumber\n      }), _editProps);\n    }\n\n    return editProps;\n  }, [focusedUser, inputsState, inputsState.disableFocus_function, inputsState.disableFocus_initials, inputsState.disableFocus_mobileNumber]);\n  var canAddGroups = React.useCallback(function (selected) {\n    return selected.length > Object.keys(focusedUser.user.groups).length;\n  }, [focusedUser.user.groups]);\n  return /*#__PURE__*/React.createElement(I18nextProvider, {\n    i18n: i18next\n  }, /*#__PURE__*/React.createElement(React.Fragment, null, !!organization && !!repoId && /*#__PURE__*/React.createElement(\"div\", {\n    className: clsx(classes.usersContainer)\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: clsx(classes.usersDataContainer)\n  }, /*#__PURE__*/React.createElement(DataView, {\n    list: users,\n    actions: usersActions,\n    selectable: \"multiple\",\n    onSelectionChange: handleOnSelectionChange,\n    onSearchChange: searchUsers,\n    selectableKey: \"nodeId\",\n    heightOfsset: 110,\n    sortBy: search.sortBy,\n    sortDirection: search.sortDirection,\n    sortMethod: sortUsers,\n    loadMoreRows: getMoreUsers,\n    onRowClick: handlefocusUser,\n    rowRenderer: function rowRenderer(row, defaultTableRowRenderer) {\n      return usersRowRenderer({\n        focusedUser: focusedUser.user,\n        row: row,\n        defaultTableRowRenderer: defaultTableRowRenderer,\n        classes: classes\n      });\n    },\n    total: search.total,\n    resultsMessage: !!search.search ? function (_ref15) {\n      var total = _ref15.total,\n          loaded = _ref15.loaded;\n      return \"( \".concat(t(\"countObjectsFound\", {\n        count: loaded,\n        object: t(\"user\", {\n          count: loaded\n        })\n      }), \" )\");\n    } : function (_ref16) {\n      var total = _ref16.total,\n          loaded = _ref16.loaded;\n      return \"( \".concat(t(\"showingCountOfTotalObjects\", {\n        count: loaded,\n        total: total,\n        object: t(\"user\", {\n          count: loaded\n        })\n      }), \" )\");\n    },\n    selectedComponent: selectedUserComponent,\n    columns: [{\n      widthTake: 0.25,\n      label: t(\"user\"),\n      dataKey: \"ec_s@surName\",\n      cellRenderer: function cellRenderer(props) {\n        return userCell({\n          classes: classes,\n          organization: organization,\n          props: props\n        });\n      }\n    }, {\n      widthTake: 0.2,\n      label: t(\"email\"),\n      dataKey: \"ec_s@email\"\n    }, {\n      widthTake: 0.2,\n      label: t(\"createdBy\"),\n      dataKey: \"createdByLastName\",\n      cellRenderer: function cellRenderer(props) {\n        return createdByCell({\n          classes: classes,\n          props: props,\n          t: t\n        });\n      }\n    }, {\n      widthTake: 0.35,\n      label: t(\"group\", {\n        count: 2\n      }),\n      dataKey: \"groups\",\n      disableSort: true,\n      cellRenderer: function cellRenderer(props) {\n        return groupCell({\n          classes: classes,\n          props: props\n        });\n      }\n    }]\n  })), focusedUser.user[\"ec_s@email\"] && /*#__PURE__*/React.createElement(\"div\", {\n    className: clsx(classes.userObjectContainer)\n  }, /*#__PURE__*/React.createElement(ObjectView, {\n    headerTitle: t(\"userDetails\"),\n    onClose: handleCloseFocusedUser,\n    properties: editProps(),\n    objectId: focusedUser.user[\"ec_s@email\"],\n    width: userDetailsWidth,\n    DrawerProps: {\n      PaperProps: {\n        className: clsx(classes.userObjectPanel)\n      }\n    }\n  }, function (_ref17) {\n    var properties = _ref17.properties,\n        objectId = _ref17.objectId;\n    return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(Typography, {\n      variant: \"h4\",\n      gutterBottom: true,\n      className: clsx(classes.focusedUserHeaderName)\n    }, focusedUser.user.userInfo.firstName, \" \", focusedUser.user.userInfo.lastName), /*#__PURE__*/React.createElement(Section, {\n      headerTitle: t(\"userProfile\"),\n      headerIcon: /*#__PURE__*/React.createElement(ListIcon, null),\n      defaultExpanded: true,\n      elevation: 0,\n      className: classes.focusedUserSection,\n      headerClassName: clsx(classes.noPadding),\n      contentClassName: clsx(classes.noPadding),\n      alwaysOpen: true\n    }, /*#__PURE__*/React.createElement(PropertyField, Object.assign({}, properties[\"ec_s@email\"], {\n      name: \"ec_s@email\",\n      labelClassName: clsx(classes.userPropertyLabel),\n      horizontal: true\n    })), /*#__PURE__*/React.createElement(PropertyField, Object.assign({}, properties[\"createdBy\"], {\n      name: \"createdBy\",\n      labelClassName: clsx(classes.userPropertyLabel),\n      horizontal: true\n    })), /*#__PURE__*/React.createElement(PropertyField, Object.assign({}, properties[\"createdOn\"], {\n      name: \"createdOn\",\n      labelClassName: clsx(classes.userPropertyLabel),\n      horizontal: true\n    })), /*#__PURE__*/React.createElement(PropertyField, Object.assign({}, properties[\"function\"], {\n      name: \"function\",\n      onChange: handleEditUserValue,\n      labelClassName: clsx(classes.userPropertyLabel),\n      objectId: objectId,\n      type: \"text\",\n      horizontal: true\n    })), /*#__PURE__*/React.createElement(PropertyField, Object.assign({}, properties[\"initials\"], {\n      name: \"initials\",\n      onChange: handleEditUserValue,\n      labelClassName: clsx(classes.userPropertyLabel),\n      objectId: objectId,\n      type: \"text\",\n      horizontal: true\n    })), /*#__PURE__*/React.createElement(PropertyField, Object.assign({}, properties[\"mobileNumber\"], {\n      name: \"mobileNumber\",\n      onChange: handleEditUserValue,\n      labelClassName: clsx(classes.userPropertyLabel),\n      objectId: objectId,\n      type: \"text\",\n      horizontal: true\n    }))), /*#__PURE__*/React.createElement(Section, {\n      headerTitle: t(\"groupMemberships\"),\n      headerIcon: /*#__PURE__*/React.createElement(GroupIcon, null),\n      defaultExpanded: true,\n      elevation: 0,\n      className: classes.focusedUserSection,\n      headerClassName: clsx(classes.noPadding),\n      contentClassName: clsx(classes.noPadding),\n      alwaysOpen: true\n    }, /*#__PURE__*/React.createElement(FormControl, {\n      disabled: inputsState.disableFocusGroups\n    }, /*#__PURE__*/React.createElement(InputLabel, {\n      shrink: false\n    }, /*#__PURE__*/React.createElement(\"div\", null, t(\"group_plural\"), !inputsState.disableFocusGroups && permisions.includes(\"allow-manage-write\") && /*#__PURE__*/React.createElement(AddRemoveGroups, {\n      classes: classes,\n      focusedUser: focusedUser,\n      handleRemove: handleRemoveFromGroup,\n      groupsInputProps: {\n        organization: organization,\n        takenGroups: Object.keys(focusedUser.user.groups),\n        actions: [{\n          icon: /*#__PURE__*/React.createElement(AddGroup, {\n            fontSize: \"small\"\n          }),\n          label: t(\"addToGroup_plural\"),\n          condition: canAddGroups,\n          title: t(\"addUserToGroups\"),\n          color: \"primary\",\n          onClick: handleAddToGroup\n        }]\n      },\n      t: t\n    }))), /*#__PURE__*/React.createElement(\"span\", {\n      className: clsx(classes.groupChipContainer)\n    }, Object.keys(focusedUser.user.groups).sort().map(function (grp, idx) {\n      var _a;\n\n      var icon;\n      return /*#__PURE__*/React.createElement(\"li\", {\n        key: idx\n      }, /*#__PURE__*/React.createElement(Chip, {\n        variant: \"outlined\",\n        size: \"small\",\n        icon: icon,\n        label: grp,\n        deleteIcon: ((_a = focusedUser === null || focusedUser === void 0 ? void 0 : focusedUser.groupsToLeave) === null || _a === void 0 ? void 0 : _a.includes(grp)) ? /*#__PURE__*/React.createElement(Checked, {\n          fontSize: \"small\"\n        }) : /*#__PURE__*/React.createElement(Unchecked, {\n          fontSize: \"small\"\n        }),\n        onDelete: permisions.includes(\"allow-manage-write\") && !inputsState.disableFocusGroups ? handleSelectToRemove(grp) : \"\",\n        className: clsx(classes.groupChip, classes.groupChipSelected)\n      }));\n    })))));\n  })), /*#__PURE__*/React.createElement(MuiDialog, Object.assign({}, dialog)), /*#__PURE__*/React.createElement(CreateUserForm, {\n    open: inputsState.openAddUser,\n    organization: organization,\n    onClose: toggleInputState(\"openAddUser\", false),\n    onUserAdded: handleUSerAdded,\n    t: t\n  }))));\n};\n\nUsers.propTypes = {\n  onSelectionChange: PropTypes.func,\n  organization: PropTypes.string,\n  repoId: PropTypes.string,\n  onError: PropTypes.func,\n  language: PropTypes.string\n};\nexport default Users;","map":{"version":3,"sources":["../../../../src/components/Users/index.js"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["import React from \"react\";\nimport PropTypes from \"prop-types\";\nimport clsx from \"clsx\";\nimport { makeStyles } from \"@material-ui/core/styles\";\nimport { FormControl, InputLabel, Chip, TableCell, Link, Popover, Typography } from \"@material-ui/core\";\nimport PopupState, { bindTrigger, bindPopover } from \"material-ui-popup-state\";\nimport { DataView, UserBadge, Button, ObjectView, Section } from \"@esko/cloud-ui-components\";\nimport PropertyField from \"../ObjectView/propertyField\";\nimport Delete from \"@material-ui/icons/Delete\";\nimport Add from \"@material-ui/icons/Add\";\nimport AddGroup from \"@material-ui/icons/GroupAdd\";\nimport GroupIcon from \"@material-ui/icons/Group\";\nimport Unchecked from \"@material-ui/icons/CheckBoxOutlineBlankRounded\";\nimport Checked from \"@material-ui/icons/CheckBoxRounded\";\nimport ListIcon from \"@material-ui/icons/List\";\nimport { editOrgUser, deleteOrgUsers, getOrgUsersJoin, removeFromGroup, addToGroup } from \"../../data/requests/iam\";\nimport MuiDialog from \"../Dialog/dialog\";\nimport CreateUserForm from \"./createUserForm\";\nimport { checkACL } from \"../../data/requests/repo\";\nimport GroupsInput from \"./GroupsInput\";\nimport useEventBus from \"../../utils/hooks/useEventBus\";\nimport { timeFormatter } from \"../../utils/dateTime\";\nimport { useComponentsTranslation } from \"../../i18n/useComponentsTranslation\";\nimport { useTranslation } from \"react-i18next\";\nconst userDetailsWidth = 400;\nconst styles = makeStyles(theme => ({\n    usersContainer: {\n        alignItems: \"center\",\n        padding: theme.spacing(1),\n        boxSizing: \"border-box\",\n        height: \"100%\",\n        width: \"100%\",\n        position: \"relative\",\n        display: \"flex\",\n        flexDirection: \"row\"\n    },\n    usersDataContainer: {\n        flex: 1,\n        height: \"100%\"\n    },\n    userObjectContainer: {\n        flexBasis: userDetailsWidth,\n        flexGrow: 0,\n        flexShrink: 0,\n        height: \"100%\",\n        marginLeftt: 10\n    },\n    userObjectPanel: {\n        borderLeftColor: theme.palette.type == \"dark\" ? theme.palette.grey[700] : theme.palette.grey[300],\n        backgroundColor: theme.palette.type === \"light\" ? \"white\" : theme.palette.action.selected\n    },\n    userObjectContent: {\n        paddingLeft: theme.spacing(2),\n        paddingRight: theme.spacing(2),\n        width: userDetailsWidth,\n        boxSizing: \"border-box\"\n    },\n    userObjectUserBadge: {\n        marginBottom: theme.spacing(2)\n    },\n    flexContainer: {\n        display: \"flex\",\n        alignItems: \"center\",\n        boxSizing: \"border-box\"\n    },\n    tableCell: {\n        flex: 1,\n        border: \"none\"\n    },\n    ellipsisCell: {\n        minWidth: 0,\n        overflow: \"hidden\",\n        textOverflow: \"ellipsis\",\n        whiteSpace: \"nowrap\"\n    },\n    userCard: {\n        maxWidth: 300\n    },\n    userCardAvatar: {\n        justifyContent: \"center\"\n    },\n    groupChipContainer: {\n        display: \"flex\",\n        flexWrap: \"wrap\",\n        listStyle: \"none\",\n        padding: theme.spacing(0.5),\n        marginTop: 20\n    },\n    groupChip: {\n        marginLeft: theme.spacing(0.5),\n        marginBottom: theme.spacing(0.5)\n    },\n    longText: {\n        overflow: \"hidden\",\n        textOverflow: \"ellipsis\",\n        display: \"-webkit-box\",\n        WebkitLineClamp: 2,\n        WebkitBoxOrient: \"vertical\",\n        whiteSpace: \"break-spaces\"\n    },\n    addGroupInput: {\n        width: 450,\n        height: 350,\n        padding: theme.spacing(2)\n    },\n    addRemoveGroups: {\n        marginLeft: theme.spacing(2)\n    },\n    createdByLine: {\n        marginTop: theme.spacing(1)\n    },\n    activeRow: {\n        cursor: \"pointer\"\n    },\n    selectedRow: {\n        backgroundColor: theme.palette.type === \"light\" ? theme.palette.primary.light : theme.palette.background.paper\n    },\n    focusedRow: {\n        backgroundColor: theme.palette.type === \"light\" ? theme.palette.grey[200] : theme.palette.leftNavBackground\n    },\n    tableRow: {\n        borderBottom: \"1px solid transparent\",\n        borderBottomColor: theme.palette.type === \"light\" ? theme.palette.grey[200] : theme.palette.grey[600]\n    },\n    tableRowHover: {\n        \"&:hover\": {\n            backgroundColor: theme.palette.type === \"light\" ? theme.palette.grey[300] : theme.palette.grey[800]\n        }\n    },\n    noPadding: {\n        padding: 0\n    },\n    focusedUserSection: {\n        background: \"transparent\"\n    },\n    focusedUserHeaderName: {\n        fontWeight: \"bold\"\n    },\n    userPropertyLabel: {\n        width: 110\n    }\n}));\nconst groupCell = ({ props, classes }) => {\n    const { rowData: { groups } } = props;\n    const groupText = groups\n        ? Object.keys(groups)\n            .sort()\n            .join(\", \")\n        : \"-\";\n    const cellData = (React.createElement(\"div\", { title: groupText, className: clsx(classes.longText) }, groupText));\n    return (React.createElement(TableCell, { component: \"div\", className: clsx(classes.tableCell, classes.flexContainer), variant: \"body\" }, cellData));\n};\nconst usersRowRenderer = ({ row, defaultTableRowRenderer, classes }) => {\n    const { onRowClick, index, isSelected, selectedRowClass, rowData } = row;\n    row.className = clsx(classes.tableRow, classes.tableRowHover, classes.flexContainer, row.className, {\n        [classes.selectedRow]: isSelected,\n        [classes.focusedRow]: rowData.focused,\n        [classes.activeRow]: typeof onRowClick == \"function\"\n    });\n    return defaultTableRowRenderer(row);\n};\nconst createdByCell = ({ props, classes, t }) => {\n    const { rowData: { createdByFirstName, createdByLastName } } = props;\n    const cellData = createdByFirstName && createdByLastName ? createdByLastName + \", \" + createdByFirstName : t(\"system\");\n    return (React.createElement(TableCell, { component: \"div\", className: clsx(classes.tableCell, classes.ellipsisCell), variant: \"body\" }, cellData));\n};\nconst userCell = ({ classes, props }) => {\n    const { rowData } = props;\n    const { firstThanLastName, editable, userInfo, [\"ec_s@function\"]: role, mobileNumber, [\"ec_s@email\"]: email, groups } = rowData;\n    return (React.createElement(TableCell, { component: \"div\", className: clsx(classes.tableCell, classes.flexContainer), variant: \"body\" },\n        React.createElement(UserBadge, { firstThanLastName: firstThanLastName, variant: \"horizontal\", size: \"small\", userInfo: userInfo })));\n};\nconst AddRemoveGroups = ({ focusedUser, handleRemove, classes, groupsInputProps, t }) => {\n    var _a;\n    return (React.createElement(\"span\", { className: clsx(classes.addRemoveGroups) },\n        React.createElement(PopupState, { variant: \"popover\", popupId: \"add-groups-popover\" }, popupState => (React.createElement(React.Fragment, null,\n            React.createElement(Link, Object.assign({}, bindTrigger(popupState)), t(\"add\")),\n            React.createElement(Popover, Object.assign({}, bindPopover(popupState), { anchorOrigin: {\n                    vertical: \"top\",\n                    horizontal: \"left\"\n                }, transformOrigin: {\n                    vertical: \"bottom\",\n                    horizontal: \"right\"\n                }, disableRestoreFocus: true }),\n                React.createElement(\"div\", { className: clsx(classes.addGroupInput) },\n                    React.createElement(GroupsInput, Object.assign({}, groupsInputProps))))))),\n        ((_a = focusedUser === null || focusedUser === void 0 ? void 0 : focusedUser.groupsToLeave) === null || _a === void 0 ? void 0 : _a.length) ? (React.createElement(React.Fragment, null,\n            \" \",\n            \"| \",\n            React.createElement(Link, { onClick: handleRemove }, t(\"remove\")),\n            \" \")) : (\"\")));\n};\nconst searchInitialState = {\n    sortBy: \"name\",\n    start: 0,\n    size: 20,\n    search: \"\",\n    sortDirection: \"asc\",\n    filterType: [\"surName\", \"firstName\", \"displayName\", \"email\"]\n};\nconst cleanDialog = {\n    title: \"\",\n    open: false,\n    content: \"\",\n    actions: \"\",\n    disableTitleTypography: false\n};\nconst emptyFocusedUser = {\n    user: {},\n    groupsToLeave: []\n};\nconst initialInputsState = {\n    openAddUser: false,\n    openAddGroups: false,\n    disableTable: false,\n    disableFocusGroups: false,\n    disableFocus_mobileNumber: false,\n    disableFocus_initial: false,\n    disableFocus_function: false\n};\nconst selectedUserComponent = ({ data, selectKey }) => (React.createElement(UserBadge, { variant: \"horizontal\", size: \"small\", userInfo: data.userInfo, firstThanLastName: data.firstThanLastName }));\nconst Users = ({ onSelectionChange, organization, repoId, onError, language }) => {\n    const handleOnSelectionChange = changed => {\n        if (typeof onSelectionChange == \"function\") {\n            onSelectionChange(changed);\n        }\n    };\n    const classes = styles();\n    const socket = React.useRef();\n    const timeoutTokenDeleteUsers = React.useRef();\n    React.useEffect(() => {\n        var _a;\n        if (repoId) {\n            if ((_a = socket.current) === null || _a === void 0 ? void 0 : _a.close) {\n                socket.current.close();\n            }\n            socket.current = useEventBus({ path: `${repoId}/EC:IAM/Users` });\n            getPermisions();\n        }\n    }, [repoId]);\n    React.useEffect(() => {\n        return () => { var _a, _b; return (((_a = socket.current) === null || _a === void 0 ? void 0 : _a.close) ? (_b = socket.current) === null || _b === void 0 ? void 0 : _b.close() : false); };\n    }, []);\n    const [users, setUsers] = React.useState([]);\n    const [search, setSearch] = React.useState({});\n    const [dialog, setDialog] = React.useState(cleanDialog);\n    const [permisions, setPermisions] = React.useState([]);\n    const [inputsState, setInputsState] = React.useState(initialInputsState);\n    const [focusedUser, focusUser] = React.useState(emptyFocusedUser);\n    const { i18next, updatei18next, I18nextProvider } = useComponentsTranslation();\n    const { t } = useTranslation(\"components\");\n    React.useEffect(() => {\n        updatei18next(language);\n    }, [language]);\n    const closeDialog = () => {\n        setDialog(cleanDialog);\n    };\n    const sortUsers = searchParams => {\n        getUsers(searchParams, true);\n    };\n    const getMoreUsers = searchParams => {\n        getUsers(searchParams);\n    };\n    const searchUsers = searchTerm => {\n        getUsers({\n            search: searchTerm,\n            startIndex: 0\n        }, true);\n    };\n    const handleError = (err, errorType) => {\n        const Repsonse = err\n            .clone()\n            .json()\n            .catch(() => res.text());\n        if (typeof onError === \"function\") {\n            onError(err);\n        }\n        else {\n            setDialog(Object.assign(Object.assign({}, cleanDialog), { title: \"ERROR:\", open: true, content: React.createElement(Typography, { variant: \"body1\" }, errorType + \": \" + JSON.stringify(err)), actions: React.createElement(Button, { onClick: closeDialog }, t(\"close\")) }));\n        }\n    };\n    const getUsers = (searchParams = {}, clear, updateFocusedUSer) => {\n        const clearWhenDone = !!clear;\n        setSearch(currSearch => {\n            const newSearch = Object.assign(Object.assign(Object.assign({}, currSearch), searchParams), { start: typeof searchParams.startIndex === undefined ? currSearch.start : searchParams.startIndex });\n            getOrgUsersJoin(Object.assign({ organization }, newSearch)).then(resp => {\n                //it's important total of the state is set before getting the new elements\n                setSearch(currSearch => (Object.assign(Object.assign({}, currSearch), { total: resp.hits.total || undefined })));\n                setUsers(currUsers => {\n                    var _a;\n                    let newUsers = clearWhenDone ? [] : [...currUsers];\n                    if ((_a = resp === null || resp === void 0 ? void 0 : resp.hits) === null || _a === void 0 ? void 0 : _a.hits) {\n                        newUsers = newUsers.concat(resp.hits.hits.map(({ _source: usr }) => {\n                            const { [\"ec_s@email\"]: email, [\"ec_s@firstName\"]: firstName, [\"ec_s@surName\"]: lastName, [\"ec_t@displayName\"]: displayName, [\"ec_s@function\"]: role, [\"ec_s@groupMembership\"]: rawGroups, [\"ec_s@mobileNumber\"]: mobileNumber, [\"ec_s@initials\"]: initials, createdByFirstName, createdByLastName, creationDate, nodeId, path } = usr;\n                            const groups = {};\n                            rawGroups.forEach(grp => {\n                                const grpKey = decodeURIComponent(grp.split(\"/\").pop());\n                                groups[grpKey] = grp;\n                            });\n                            return {\n                                nodeId: nodeId[0].parentNodeId,\n                                path,\n                                [\"ec_s@firstName\"]: firstName,\n                                [\"ec_s@surName\"]: lastName,\n                                [\"ec_s@email\"]: email,\n                                [\"ec_t@displayName\"]: displayName,\n                                [\"ec_s@function\"]: role,\n                                createdByFirstName,\n                                createdByLastName,\n                                creationDate,\n                                initials,\n                                firstThanLastName: false,\n                                editable: permisions.includes(\"allow-manage-write\"),\n                                groups,\n                                mobileNumber,\n                                userInfo: {\n                                    firstName,\n                                    lastName,\n                                    displayName,\n                                    avatar: nodeId[0][\"contentPath-S3-thumbnail-200x200\"]\n                                }\n                            };\n                        }));\n                    }\n                    focusUser(currFocusedUser => {\n                        const email = currFocusedUser === null || currFocusedUser === void 0 ? void 0 : currFocusedUser.user[\"ec_s@email\"];\n                        if (!email) {\n                            return currFocusedUser;\n                        }\n                        const newFocusedUserData = newUsers.filter(usr => usr[\"ec_s@email\"] === email);\n                        if (newFocusedUserData[0]) {\n                            newFocusedUserData[0].focused = true;\n                        }\n                        return Object.assign(Object.assign({}, currFocusedUser), { user: newFocusedUserData[0] || Object.assign({}, currFocusedUser.user) });\n                    });\n                    return newUsers;\n                });\n            }, err => {\n                handleError(err, t(\"gettingUsers\"));\n            });\n            return newSearch;\n        });\n    };\n    const toggleInputState = (key, open) => () => {\n        setInputsState(currInputState => {\n            return Object.assign(Object.assign({}, currInputState), { [key]: open });\n        });\n    };\n    const confirmDeleteUsers = ({ selected, clearSelected }) => {\n        const count = (selected === null || selected === void 0 ? void 0 : selected.length) || 1;\n        const aboutDeleteUsers = users\n            .filter(usr => selected.indexOf(usr.nodeId) > -1)\n            .map(({ [\"ec_s@email\"]: name, path }) => ({ name, path }));\n        const actions = (React.createElement(React.Fragment, null,\n            React.createElement(Button, { onClick: closeDialog }, t(\"no\")),\n            React.createElement(Button, { onClick: () => deleteUsers(aboutDeleteUsers, clearSelected) }, t(\"yes\"))));\n        setDialog(Object.assign(Object.assign({}, cleanDialog), { title: t(\"deleteUser\", { count }), open: true, content: React.createElement(Typography, { variant: \"body1\" }, t(\"deleteUserPrompt\", { count })), actions: actions }));\n    };\n    const deleteUsers = (users, clearSelected) => {\n        const count = (users === null || users === void 0 ? void 0 : users.length) || 1;\n        setDialog(Object.assign(Object.assign({}, cleanDialog), { title: t(\"deleteUser\", { count }), open: true, content: React.createElement(Typography, { variant: \"body1\" }, t(\"deletingUser\", { count })), actions: \"\" }));\n        deleteOrgUsers({ organization, users }).then(resp => {\n            setRefreshListener({\n                callbackId: \"deletingUsers\",\n                callback: msg => {\n                    const jsonMsg = JSON.parse(msg.data);\n                    if (jsonMsg.payloadType === \"ChildRemoved\") {\n                        clearTimeout(timeoutTokenDeleteUsers.current);\n                        timeoutTokenDeleteUsers.current = setTimeout(() => {\n                            getUsers(\"\", true);\n                            socket.current.stopListening(\"deletingUsers\");\n                            setDialog(Object.assign(Object.assign({}, cleanDialog), { title: t(\"deleteUser\", { count }), open: true, content: React.createElement(Typography, { variant: \"body1\" }, t(\"deleteUserSuccess\", { count })), actions: React.createElement(Button, { onClick: closeDialog }, t(\"close\")) }));\n                        }, 500);\n                    }\n                }\n            });\n            clearSelected();\n            const focusedUserInDeleted = users.some(usr => usr.name === focusedUser.user[\"ec_s@email\"]);\n            if (focusedUserInDeleted) {\n                focusUser(emptyFocusedUser);\n            }\n        }, err => {\n            handleError(err, t(\"deletingUsers\"));\n        });\n    };\n    const handleUSerAdded = () => {\n        /* The service to add a user seems to wait for the user to be added to the index\n        as it needs to set permisions and initial group adding, so we don't need listen to\n        the even bus for this as we will always missing the event*/\n        setDialog(Object.assign(Object.assign({}, cleanDialog), { title: t(\"addUser\"), open: true, content: React.createElement(Typography, { variant: \"body1\" }, t(\"addUserSuccess\")), actions: React.createElement(Button, { onClick: closeDialog }, t(\"close\")) }));\n        getUsers(\"\", true);\n    };\n    const getPermisions = () => {\n        if (!repoId) {\n            return;\n        }\n        let aces = [];\n        const nodePath = [repoId, \"EC:IAM\", \"Users\"];\n        checkACL({ nodePath }).then(resp => {\n            var _a;\n            if (((_a = resp === null || resp === void 0 ? void 0 : resp.aces) === null || _a === void 0 ? void 0 : _a.length) && resp.aces[0].ace) {\n                aces = resp.aces[0].ace.split(\"|\");\n            }\n            setPermisions(aces);\n        }, err => {\n            handleError(err, t(\"gettingPermisions\"));\n        });\n    };\n    const addUserCondition = React.useCallback(selected => {\n        return permisions.indexOf(\"allow-manage-create\") > -1;\n    }, [permisions]);\n    const deleteUserCondition = React.useCallback(selected => {\n        return Array.isArray(selected) && selected.length > 0 && permisions.indexOf(\"allow-manage-delete\") > -1;\n    }, [permisions]);\n    const usersActions = [\n        {\n            icon: React.createElement(Delete, null),\n            label: t(\"deleteUser\", { count: 2 }),\n            condition: deleteUserCondition,\n            onClick: confirmDeleteUsers\n        },\n        {\n            icon: React.createElement(Add, null),\n            label: t(\"addUser\"),\n            onClick: toggleInputState(\"openAddUser\", true),\n            condition: addUserCondition,\n            color: \"primary\"\n        }\n    ];\n    React.useEffect(() => {\n        setUsers([]);\n        focusUser(emptyFocusedUser);\n        setInputsState(initialInputsState);\n        getUsers(searchInitialState);\n    }, [organization]);\n    const setRefreshListener = ({ callbackId, callback = msg => console.log(msg) }) => {\n        if (socket.current.listen) {\n            socket.current.listen(callback, callbackId);\n        }\n        else {\n            console.error(\"users socket not set\");\n        }\n    };\n    const handlefocusUser = ({ event, index, rowData }) => {\n        //assing new data to focused user\n        focusUser({\n            user: rowData,\n            groupsToLeave: []\n        });\n        //mark List user as focused for row styling\n        setUsers(currUsers => {\n            let newUsers = [...currUsers];\n            newUsers.some((usr, idx, arr) => {\n                arr[idx] = usr.focused ? Object.assign(Object.assign({}, usr), { focused: false }) : arr[idx];\n                return usr.focused;\n            });\n            newUsers[index].focused = true;\n            return newUsers;\n        });\n        //reset inputs\n        setInputsState(initialInputsState);\n    };\n    const handleCloseFocusedUser = () => {\n        focusUser(emptyFocusedUser);\n        setUsers(currUsers => {\n            let newUsers = [...currUsers];\n            newUsers.some((usr, idx, arr) => {\n                arr[idx] = usr.focused ? Object.assign(Object.assign({}, usr), { focused: false }) : arr[idx];\n                return usr.focused;\n            });\n            return newUsers;\n        });\n    };\n    const handleSelectToRemove = group => () => {\n        focusUser(currFocusUser => {\n            let newGroupsToLeave = currFocusUser.groupsToLeave;\n            const existIn = newGroupsToLeave.indexOf(group);\n            if (existIn > -1) {\n                newGroupsToLeave.splice(existIn, 1);\n            }\n            else {\n                newGroupsToLeave.push(group);\n            }\n            return Object.assign(Object.assign({}, currFocusUser), { groupsToLeave: newGroupsToLeave });\n        });\n    };\n    const handleRemoveFromGroup = e => {\n        if (e) {\n            e.preventDefault();\n        }\n        toggleInputState(\"disableFocusGroups\", true)();\n        removeFromGroup({ groupNames: focusedUser.groupsToLeave, organization, email: focusedUser.user[\"ec_s@email\"] }).then(resp => {\n            //now that it went well remove groups locally and subscribe a listener for the bus event\n            setRefreshListener({\n                callbackId: focusedUser.user.nodeId,\n                callback: msg => {\n                    console.log(msg);\n                    const jsonMsg = JSON.parse(msg.data);\n                    if (jsonMsg.nodeId === focusedUser.user.nodeId) {\n                        getUsers(\"\", true);\n                    }\n                    socket.current.stopListening(focusedUser.user.nodeId);\n                    toggleInputState(\"disableFocusGroups\", false)();\n                }\n            });\n            focusUser(currentFocusedUser => {\n                const newFocusedUser = Object.assign({}, currentFocusedUser);\n                newFocusedUser.groupsToLeave.forEach(grp => {\n                    delete newFocusedUser.user.groups[grp];\n                });\n                newFocusedUser.groupsToLeave = [];\n                setUsers(currUsers => {\n                    let newUsers = [...currUsers];\n                    newUsers.some((usr, idx, arr) => {\n                        const found = usr[\"ec_s@email\"] === focusedUser.user[\"ec_s@email\"];\n                        arr[idx] = found ? Object.assign({}, focusedUser.user) : arr[idx];\n                        return found;\n                    });\n                    return newUsers;\n                });\n                return newFocusedUser;\n            });\n        }, err => {\n            handleError(err, t(\"leavingGroups\"));\n        });\n    };\n    const handleAddToGroup = ({ selected, clearSelected }) => {\n        const userGroups = Object.keys(focusedUser.user.groups);\n        const groupsToAdd = selected.filter(grp => !userGroups.includes(grp));\n        toggleInputState(\"disableFocusGroups\", true)();\n        addToGroup({ groupNames: groupsToAdd, organization, email: focusedUser.user[\"ec_s@email\"] }).then(resp => {\n            //now that it went well add groups locally and subscribe a listener for the bus event\n            setRefreshListener({\n                callbackId: focusedUser.user.nodeId,\n                callback: msg => {\n                    console.log(msg);\n                    const jsonMsg = JSON.parse(msg.data);\n                    if (jsonMsg.nodeId === focusedUser.user.nodeId) {\n                        getUsers(\"\", true);\n                    }\n                    socket.current.stopListening(focusedUser.user.nodeId);\n                    toggleInputState(\"disableFocusGroups\", false)();\n                }\n            });\n            focusUser(currentFocusedUser => {\n                const newFocusedUser = Object.assign({}, currentFocusedUser);\n                groupsToAdd.forEach(grp => {\n                    newFocusedUser.user.groups[grp] = {};\n                });\n                setUsers(currUsers => {\n                    let newUsers = [...currUsers];\n                    newUsers.some((usr, idx, arr) => {\n                        const found = usr[\"ec_s@email\"] === focusedUser.user[\"ec_s@email\"];\n                        arr[idx] = found ? Object.assign({}, focusedUser.user) : arr[idx];\n                        return found;\n                    });\n                    return newUsers;\n                });\n                return newFocusedUser;\n            });\n        }, err => {\n            handleError(err, t(\"addingToGroups\"));\n        });\n    };\n    const updateFocusedUserProp = (valueKey, value) => {\n        focusUser(currentFocusedUser => {\n            const newFocusedUser = Object.assign({}, currentFocusedUser);\n            if (newFocusedUser.user[valueKey]) {\n                newFocusedUser.user[valueKey] = value;\n            }\n            else if (newFocusedUser.user[\"ec_s@\" + valueKey]) {\n                newFocusedUser.user[\"ec_s@\" + valueKey] = value;\n            }\n            return newFocusedUser;\n        });\n    };\n    const handleEditUserValue = valueObj => {\n        const valueKey = Object.keys(valueObj)[0];\n        const value = Object.values(valueObj)[0];\n        const callbackId = focusedUser.user.nodeId + \"_\" + valueKey;\n        editOrgUser({ organization, email: focusedUser.user[\"ec_s@email\"], body: Object.assign({}, valueObj) }).then(resp => {\n            //subscribe a listener for the indexed bus event\n            updateFocusedUserProp(valueKey, value);\n            setRefreshListener({\n                callbackId,\n                callback: msg => {\n                    const jsonMsg = JSON.parse(msg.data);\n                    if (jsonMsg.payload.includes(valueKey)) {\n                        console.log(jsonMsg.payload, valueKey);\n                        getUsers(\"\", true);\n                        socket.current.stopListening(callbackId);\n                    }\n                }\n            });\n        }, err => {\n            handleError(err, t(\"modifiyingUser\"));\n        });\n    };\n    const editProps = React.useCallback(() => {\n        let editProps = undefined;\n        if (focusedUser) {\n            editProps = {\n                [\"ec_s@email\"]: {\n                    type: \"text\",\n                    label: t(\"email\"),\n                    value: focusedUser.user[\"ec_s@email\"],\n                    readOnly: true\n                },\n                createdBy: {\n                    type: \"text\",\n                    label: t(\"createdBy\"),\n                    value: focusedUser.user.createdByFirstName && focusedUser.user.createdByLastName\n                        ? `${focusedUser.user.createdByLastName}, ${focusedUser.user.createdByFirstName}`\n                        : t(\"system\"),\n                    readOnly: true\n                },\n                createdOn: {\n                    type: \"text\",\n                    label: t(\"createdOn\"),\n                    value: timeFormatter(new Date(focusedUser.user.creationDate), i18next.language),\n                    readOnly: true\n                },\n                function: {\n                    type: \"text\",\n                    label: t(\"function\"),\n                    value: focusedUser.user[\"ec_s@function\"],\n                    readOnly: inputsState.disableFocus_function\n                },\n                initials: {\n                    type: \"text\",\n                    label: t(\"initials\"),\n                    value: focusedUser.user.initials,\n                    readOnly: inputsState.disableFocus_initials\n                },\n                mobileNumber: {\n                    type: \"text\",\n                    label: t(\"phone\"),\n                    value: focusedUser.user.mobileNumber,\n                    readOnly: inputsState.disableFocus_mobileNumber\n                }\n            };\n        }\n        return editProps;\n    }, [\n        focusedUser,\n        inputsState,\n        inputsState.disableFocus_function,\n        inputsState.disableFocus_initials,\n        inputsState.disableFocus_mobileNumber\n    ]);\n    const canAddGroups = React.useCallback(selected => selected.length > Object.keys(focusedUser.user.groups).length, [\n        focusedUser.user.groups\n    ]);\n    return (React.createElement(I18nextProvider, { i18n: i18next },\n        React.createElement(React.Fragment, null, !!organization && !!repoId && (React.createElement(\"div\", { className: clsx(classes.usersContainer) },\n            React.createElement(\"div\", { className: clsx(classes.usersDataContainer) },\n                React.createElement(DataView, { list: users, actions: usersActions, selectable: \"multiple\", onSelectionChange: handleOnSelectionChange, onSearchChange: searchUsers, selectableKey: \"nodeId\", heightOfsset: 110, sortBy: search.sortBy, sortDirection: search.sortDirection, sortMethod: sortUsers, loadMoreRows: getMoreUsers, onRowClick: handlefocusUser, rowRenderer: (row, defaultTableRowRenderer) => usersRowRenderer({ focusedUser: focusedUser.user, row, defaultTableRowRenderer, classes }), total: search.total, resultsMessage: !!search.search\n                        ? ({ total, loaded }) => `( ${t(\"countObjectsFound\", { count: loaded, object: t(\"user\", { count: loaded }) })} )`\n                        : ({ total, loaded }) => `( ${t(\"showingCountOfTotalObjects\", { count: loaded, total, object: t(\"user\", { count: loaded }) })} )`, selectedComponent: selectedUserComponent, columns: [\n                        {\n                            widthTake: 0.25,\n                            label: t(\"user\"),\n                            dataKey: \"ec_s@surName\",\n                            cellRenderer: props => userCell({ classes, organization, props })\n                        },\n                        {\n                            widthTake: 0.2,\n                            label: t(\"email\"),\n                            dataKey: \"ec_s@email\"\n                        },\n                        {\n                            widthTake: 0.2,\n                            label: t(\"createdBy\"),\n                            dataKey: \"createdByLastName\",\n                            cellRenderer: props => createdByCell({ classes, props, t })\n                        },\n                        {\n                            widthTake: 0.35,\n                            label: t(\"group\", { count: 2 }),\n                            dataKey: \"groups\",\n                            disableSort: true,\n                            cellRenderer: props => groupCell({ classes, props })\n                        }\n                    ] })),\n            focusedUser.user[\"ec_s@email\"] && (React.createElement(\"div\", { className: clsx(classes.userObjectContainer) },\n                React.createElement(ObjectView, { headerTitle: t(\"userDetails\"), onClose: handleCloseFocusedUser, properties: editProps(), objectId: focusedUser.user[\"ec_s@email\"], width: userDetailsWidth, DrawerProps: {\n                        PaperProps: {\n                            className: clsx(classes.userObjectPanel)\n                        }\n                    } }, ({ properties, objectId }) => (React.createElement(React.Fragment, null,\n                    React.createElement(Typography, { variant: \"h4\", gutterBottom: true, className: clsx(classes.focusedUserHeaderName) },\n                        focusedUser.user.userInfo.firstName,\n                        \" \",\n                        focusedUser.user.userInfo.lastName),\n                    React.createElement(Section, { headerTitle: t(\"userProfile\"), headerIcon: React.createElement(ListIcon, null), defaultExpanded: true, elevation: 0, className: classes.focusedUserSection, headerClassName: clsx(classes.noPadding), contentClassName: clsx(classes.noPadding), alwaysOpen: true },\n                        React.createElement(PropertyField, Object.assign({}, properties[\"ec_s@email\"], { name: \"ec_s@email\", labelClassName: clsx(classes.userPropertyLabel), horizontal: true })),\n                        React.createElement(PropertyField, Object.assign({}, properties[\"createdBy\"], { name: \"createdBy\", labelClassName: clsx(classes.userPropertyLabel), horizontal: true })),\n                        React.createElement(PropertyField, Object.assign({}, properties[\"createdOn\"], { name: \"createdOn\", labelClassName: clsx(classes.userPropertyLabel), horizontal: true })),\n                        React.createElement(PropertyField, Object.assign({}, properties[\"function\"], { name: \"function\", onChange: handleEditUserValue, labelClassName: clsx(classes.userPropertyLabel), objectId: objectId, type: \"text\", horizontal: true })),\n                        React.createElement(PropertyField, Object.assign({}, properties[\"initials\"], { name: \"initials\", onChange: handleEditUserValue, labelClassName: clsx(classes.userPropertyLabel), objectId: objectId, type: \"text\", horizontal: true })),\n                        React.createElement(PropertyField, Object.assign({}, properties[\"mobileNumber\"], { name: \"mobileNumber\", onChange: handleEditUserValue, labelClassName: clsx(classes.userPropertyLabel), objectId: objectId, type: \"text\", horizontal: true }))),\n                    React.createElement(Section, { headerTitle: t(\"groupMemberships\"), headerIcon: React.createElement(GroupIcon, null), defaultExpanded: true, elevation: 0, className: classes.focusedUserSection, headerClassName: clsx(classes.noPadding), contentClassName: clsx(classes.noPadding), alwaysOpen: true },\n                        React.createElement(FormControl, { disabled: inputsState.disableFocusGroups },\n                            React.createElement(InputLabel, { shrink: false },\n                                React.createElement(\"div\", null,\n                                    t(\"group_plural\"),\n                                    !inputsState.disableFocusGroups && permisions.includes(\"allow-manage-write\") && (React.createElement(AddRemoveGroups, { classes: classes, focusedUser: focusedUser, handleRemove: handleRemoveFromGroup, groupsInputProps: {\n                                            organization,\n                                            takenGroups: Object.keys(focusedUser.user.groups),\n                                            actions: [\n                                                {\n                                                    icon: React.createElement(AddGroup, { fontSize: \"small\" }),\n                                                    label: t(\"addToGroup_plural\"),\n                                                    condition: canAddGroups,\n                                                    title: t(\"addUserToGroups\"),\n                                                    color: \"primary\",\n                                                    onClick: handleAddToGroup\n                                                }\n                                            ]\n                                        }, t: t })))),\n                            React.createElement(\"span\", { className: clsx(classes.groupChipContainer) }, Object.keys(focusedUser.user.groups)\n                                .sort()\n                                .map((grp, idx) => {\n                                var _a;\n                                let icon;\n                                return (React.createElement(\"li\", { key: idx },\n                                    React.createElement(Chip, { variant: \"outlined\", size: \"small\", icon: icon, label: grp, deleteIcon: ((_a = focusedUser === null || focusedUser === void 0 ? void 0 : focusedUser.groupsToLeave) === null || _a === void 0 ? void 0 : _a.includes(grp)) ? (React.createElement(Checked, { fontSize: \"small\" })) : (React.createElement(Unchecked, { fontSize: \"small\" })), onDelete: permisions.includes(\"allow-manage-write\") && !inputsState.disableFocusGroups\n                                            ? handleSelectToRemove(grp)\n                                            : \"\", className: clsx(classes.groupChip, classes.groupChipSelected) })));\n                            }))))))))),\n            React.createElement(MuiDialog, Object.assign({}, dialog)),\n            React.createElement(CreateUserForm, { open: inputsState.openAddUser, organization: organization, onClose: toggleInputState(\"openAddUser\", false), onUserAdded: handleUSerAdded, t: t }))))));\n};\nUsers.propTypes = {\n    onSelectionChange: PropTypes.func,\n    organization: PropTypes.string,\n    repoId: PropTypes.string,\n    onError: PropTypes.func,\n    language: PropTypes.string\n};\nexport default Users;\n//# sourceMappingURL=index.js.map"]},"metadata":{},"sourceType":"module"}